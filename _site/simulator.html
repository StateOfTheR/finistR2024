<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Julie Aubert">
<meta name="author" content="Caroline Cognot">
<meta name="author" content="Annaïg De Walsche">
<meta name="author" content="Cédric Midoux">
<meta name="author" content="Aymeric Stamm">
<meta name="author" content="Florian Teste">
<meta name="dcterms.date" content="2024-08-19">

<title>Finist’R 2024 - Setting up simulations in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Finist’R 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/StateOfTheR/finistR2024" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./instructions.html" rel="" target="">
 <span class="menu-text">Instructions</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-themes-to-be-developped" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Themes to be developped</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-themes-to-be-developped">    
        <li>
    <a class="dropdown-item" href="./theme.qmd" rel="" target="">
 <span class="dropdown-text">List to discussed</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#list-of-packages-for-data-simulation" id="toc-list-of-packages-for-data-simulation" class="nav-link active" data-scroll-target="#list-of-packages-for-data-simulation">List of packages for data simulation</a></li>
  <li><a href="#how-to-choose" id="toc-how-to-choose" class="nav-link" data-scroll-target="#how-to-choose">How to choose ?</a></li>
  <li><a href="#simpr" id="toc-simpr" class="nav-link" data-scroll-target="#simpr"><strong>simpr</strong></a>
  <ul class="collapse">
  <li><a href="#usual-base-r-solution" id="toc-usual-base-r-solution" class="nav-link" data-scroll-target="#usual-base-r-solution">Usual base R solution</a></li>
  <li><a href="#solution-via-simpr" id="toc-solution-via-simpr" class="nav-link" data-scroll-target="#solution-via-simpr">Solution via <strong>simpr</strong></a></li>
  <li><a href="#a-complete-solution-with-varying-parameters" id="toc-a-complete-solution-with-varying-parameters" class="nav-link" data-scroll-target="#a-complete-solution-with-varying-parameters">A complete solution with varying parameters</a></li>
  <li><a href="#philosophy" id="toc-philosophy" class="nav-link" data-scroll-target="#philosophy">Philosophy</a></li>
  <li><a href="#reproducible-workflows" id="toc-reproducible-workflows" class="nav-link" data-scroll-target="#reproducible-workflows">Reproducible workflows</a></li>
  <li><a href="#other-features" id="toc-other-features" class="nav-link" data-scroll-target="#other-features">Other features</a></li>
  <li><a href="#pros-cons" id="toc-pros-cons" class="nav-link" data-scroll-target="#pros-cons">Pros &amp; Cons</a></li>
  </ul></li>
  <li><a href="#simulator" id="toc-simulator" class="nav-link" data-scroll-target="#simulator">Simulator</a>
  <ul class="collapse">
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting started</a>
  <ul class="collapse">
  <li><a href="#what-is-in-model_functions" id="toc-what-is-in-model_functions" class="nav-link" data-scroll-target="#what-is-in-model_functions">what is in model_functions</a></li>
  <li><a href="#what-is-in-method_functions" id="toc-what-is-in-method_functions" class="nav-link" data-scroll-target="#what-is-in-method_functions">what is in method_functions</a></li>
  <li><a href="#what-is-in-eval_functions" id="toc-what-is-in-eval_functions" class="nav-link" data-scroll-target="#what-is-in-eval_functions">what is in eval_functions</a></li>
  <li><a href="#what-is-in-main" id="toc-what-is-in-main" class="nav-link" data-scroll-target="#what-is-in-main">what is in main</a></li>
  </ul></li>
  <li><a href="#important-functions" id="toc-important-functions" class="nav-link" data-scroll-target="#important-functions">Important functions :</a></li>
  <li><a href="#final-notes" id="toc-final-notes" class="nav-link" data-scroll-target="#final-notes">Final notes :</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Setting up simulations in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Julie Aubert </p>
             <p>Caroline Cognot </p>
             <p>Annaïg De Walsche </p>
             <p>Cédric Midoux </p>
             <p>Aymeric Stamm </p>
             <p>Florian Teste </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="list-of-packages-for-data-simulation" class="level2">
<h2 class="anchored" data-anchor-id="list-of-packages-for-data-simulation">List of packages for data simulation</h2>
<ul>
<li><a href="https://jacobbien.github.io/simulator/"><strong>simulator</strong></a></li>
<li><a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></li>
<li><a href="https://declaredesign.org/r/declaredesign/"><strong>DeclareDesign</strong></a></li>
<li><a href="https://github.com/FunWithR/MonteCarlo"><strong>MonteCarlo</strong></a></li>
<li><a href="https://yu-group.github.io/simChef/index.html"><strong>simChef</strong></a></li>
<li><a href="https://cran.r-project.org/web/packages/SimEngine/vignettes/SimEngine.html"><strong>simEngine</strong></a></li>
</ul>
</section>
<section id="how-to-choose" class="level2">
<h2 class="anchored" data-anchor-id="how-to-choose">How to choose ?</h2>
<ul>
<li>Number of dependencies</li>
<li>Number of reverse dependencies</li>
<li>Date of latest commit</li>
<li>Date of last release</li>
<li>Is it on CRAN or only on Github?</li>
<li>Who developed it?</li>
<li>Philosophy</li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Version</th>
<th>#deps</th>
<th>#rev deps</th>
<th>Latest commit</th>
<th>Latest release</th>
<th>Doc</th>
<th>On CRAN?</th>
<th>Developers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://declaredesign.org/r/declaredesign/"><strong>DeclareDesign</strong></a></td>
<td>1.0.10</td>
<td>2</td>
<td>1</td>
<td>2024-04-13</td>
<td>2024-04-21</td>
<td></td>
<td>Yes</td>
<td>Graeme Blair</td>
</tr>
<tr class="even">
<td><a href="https://github.com/FunWithR/MonteCarlo"><strong>MonteCarlo</strong></a></td>
<td>1.0.6</td>
<td>6</td>
<td>0</td>
<td>2019-01-31</td>
<td>2019-01-31</td>
<td></td>
<td>Yes</td>
<td>Christian Hendrik Leschinski</td>
</tr>
<tr class="odd">
<td><a href="https://yu-group.github.io/simChef/index.html"><strong>simChef</strong></a></td>
<td>0.1.0</td>
<td>22</td>
<td>0</td>
<td>2024-03-20</td>
<td>NA</td>
<td></td>
<td>No</td>
<td>Tiffany Tang, James Duncan</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/SimEngine/vignettes/SimEngine.html"><strong>simEngine</strong></a></td>
<td>1.4.0</td>
<td>6</td>
<td>0</td>
<td>2024-04-13</td>
<td>2024-04-04</td>
<td></td>
<td>Yes</td>
<td>Avi Kenny, Charles Wolock</td>
</tr>
<tr class="odd">
<td><a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></td>
<td>0.2.6</td>
<td>11</td>
<td>0</td>
<td>2024-07-16</td>
<td>2023-04-26</td>
<td></td>
<td>Yes</td>
<td>Ethan Brown</td>
</tr>
<tr class="even">
<td><a href="https://jacobbien.github.io/simulator/"><strong>simulator</strong></a></td>
<td>0.2.5</td>
<td>1</td>
<td>0</td>
<td>2023-02-02</td>
<td>2023-02-04</td>
<td></td>
<td>Yes</td>
<td>Jacob Bien</td>
</tr>
</tbody>
</table>
</section>
<section id="simpr" class="level2">
<h2 class="anchored" data-anchor-id="simpr"><a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Problem
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Study: Pre-post comparison of the “Triglicious” intervention;</li>
<li>Research question: Did Triglicious improve students’ math scores?</li>
<li>Method: Paired t-test</li>
</ul>
</div>
</div>
<section id="usual-base-r-solution" class="level3">
<h3 class="anchored" data-anchor-id="usual-base-r-solution">Usual base R solution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set up parameters</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">c</span>(100L, 150L, 200L)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mean_diffs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>reps <span class="ot">&lt;-</span> 10L</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Bring together into data frame</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>results_template <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> ns, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_diff =</span> mean_diffs, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> sds, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.value =</span> <span class="cn">NA_real_</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>base_r_sim <span class="ot">&lt;-</span> results_template[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(results_template), <span class="at">each =</span> reps), ]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop over rows of the data frame and calculate the p-value</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(results_template)) {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> base_r_sim[i,]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  pre <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(params<span class="sc">$</span>n, <span class="dv">0</span>, params<span class="sc">$</span>sd)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(params<span class="sc">$</span>n, params<span class="sc">$</span>mean_diff, params<span class="sc">$</span>sd)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  base_r_sim<span class="sc">$</span>p.value[i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(pre, post)<span class="sc">$</span>p.value</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Display table output</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(base_r_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-46aa60f97b8d07407291" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-46aa60f97b8d07407291">{"x":{"filter":"none","vertical":false,"data":[["1","1.1","1.2","1.3","1.4","1.5","1.6","1.7","1.8","1.9","2","2.1","2.2","2.3","2.4","2.5","2.6","2.7","2.8","2.9","3","3.1","3.2","3.3","3.4","3.5","3.6","3.7","3.8","3.9","4","4.1","4.2","4.3","4.4","4.5","4.6","4.7","4.8","4.9","5","5.1","5.2","5.3","5.4","5.5","5.6","5.7","5.8","5.9","6","6.1","6.2","6.3","6.4","6.5","6.6","6.7","6.8","6.9","7","7.1","7.2","7.3","7.4","7.5","7.6","7.7","7.8","7.9","8","8.1","8.2","8.3","8.4","8.5","8.6","8.7","8.8","8.9","9","9.1","9.2","9.3","9.4","9.5","9.6","9.7","9.8","9.9","10","10.1","10.2","10.3","10.4","10.5","10.6","10.7","10.8","10.9","11","11.1","11.2","11.3","11.4","11.5","11.6","11.7","11.8","11.9","12","12.1","12.2","12.3","12.4","12.5","12.6","12.7","12.8","12.9","13","13.1","13.2","13.3","13.4","13.5","13.6","13.7","13.8","13.9","14","14.1","14.2","14.3","14.4","14.5","14.6","14.7","14.8","14.9","15","15.1","15.2","15.3","15.4","15.5","15.6","15.7","15.8","15.9","16","16.1","16.2","16.3","16.4","16.5","16.6","16.7","16.8","16.9","17","17.1","17.2","17.3","17.4","17.5","17.6","17.7","17.8","17.9","18","18.1","18.2","18.3","18.4","18.5","18.6","18.7","18.8","18.9"],[100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200],[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],[0.2845207987128444,0.2700473502641071,0.6662803095471443,0.5029523249104211,0.6863840768744648,0.3796438117313865,0.1413292774616699,0.8400677055757735,0.4454463130605117,0.53546259356649,0.164269040284426,0.008811801987200333,0.6761298531172883,0.3996911798942515,0.1455668831474311,0.1532684169679274,0.06606412928635226,0.1088688067179056,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>n<\/th>\n      <th>mean_diff<\/th>\n      <th>sd<\/th>\n      <th>p.value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"n","targets":1},{"name":"mean_diff","targets":2},{"name":"sd","targets":3},{"name":"p.value","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>What is bad according to <a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a> authors:</p>
<ul>
<li>Most important pieces (data generating process, model specification, definitions, varying parameters) are hidden;</li>
<li>What if there is an error?</li>
<li>What about parallelization?</li>
<li>Is this code sufficiently readable? Without the comments?</li>
</ul>
</section>
<section id="solution-via-simpr" class="level3">
<h3 class="anchored" data-anchor-id="solution-via-simpr">Solution via <a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specify pre and post scores that differ by a given amount</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre  =</span> <span class="sc">~</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sd), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> <span class="sc">~</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(n, mean_diff, sd)) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Define parameters that can be varied</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean_diff =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Generate datasets</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fit datasets</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">t =</span> <span class="sc">~</span><span class="fu">t.test</span>(post, pre, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Collect results</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_fits</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-a1c3079a69f02c821648" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a1c3079a69f02c821648">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],[50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],["t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t"],[14.6439140761824,-2.061726611932796,6.27628581224289,9.280264095430834,14.60243556096653,14.53395795545262,9.505570055333045,-0.4121164420012725,4.087930289049432,12.50505813506168,6.170449281698282,14.90607226701439,14.41780798202662,16.64518495072889,8.303149672728553,3.648788066485332,11.18305011792875,10.15524236553149,5.051414813533906,-0.5830218367473307,18.02349801922823,11.01519163042048,6.103314552416536,11.59105929297517,12.40703695870423,8.732481925792209,15.81773499470519,9.253174624082764,12.50344536771721,2.041958668504475,14.27389274985829,8.872972687901916,14.23781843759246,8.045807659143469,15.16663009179239,18.66455863529756,9.474114880224807,3.357796164865451,7.879911592461895,10.03748013538905,17.35735776150959,12.69064434625285,6.937049393613048,17.40310869115197,5.723724865384811,10.00501174364559,13.13897823285576,11.94235369376959,12.69741006074155,11.91664605728411,12.05092445668704,8.406079355275336,16.33184925117474,11.68483078540283,13.99298843205762,9.960378734927568,15.17971689121816,12.2230930844234,10.40644978046126,11.10202913587071,16.05337030366848,18.34409967665949,18.26141074893457,7.693446173603193,7.99902256580774,4.560859414659287,7.365858449022049,17.7608505815655,16.42288588412783,12.18346498880012,17.13612383235677,7.035638607856821,12.16683971677782,4.309574355852884,10.26973400628544,8.414724646784631,7.868458472997224,12.03747464159387,10.58051430797956,13.06030354464324,17.335788779967,6.438612316063441,15.21136797998315,19.13785076834605,8.208902305088317,7.303817422665974,8.815223829791368,14.26257524084032,8.207406878549106,8.996340717605014,5.197083478366884,5.498412389831711,7.981402901153955,7.104072663056365,13.45779244198009,2.893373654543637,5.687761750535644,6.345367504398525,14.01738258754459,9.853723761713031],[3.441977729328285,-0.5018517738426913,1.35524565528302,2.083563608910857,2.589138471344344,2.685165753871649,1.761325771051717,-0.08609103261958492,0.8908239636048394,2.478230091437852,1.285408267140206,2.559084528447268,2.657207049794566,3.224275537118773,1.755604672209586,0.680660492625991,2.419104910336525,1.895396758980216,0.9725742178374832,-0.1117600182638434,3.647210940360956,2.091332605482138,1.259040737148415,2.107389022992035,2.690630251923073,1.856350390170517,3.279055371203857,1.923589552299361,2.516194943494767,0.3972638730489442,2.897036492698197,2.022535986091601,2.79504140344431,1.756341294404865,2.997891188439815,3.441745486036163,1.942994882418197,0.7234200055507954,1.689123916910114,1.925013734604748,3.888333777875592,2.318743601015843,1.242657535620734,3.842152558158974,1.158728005371226,2.135094821081134,2.883680113201339,2.411026683187906,2.647866985952648,2.448873541596355,2.382389267361864,1.79871914033161,2.998266490196694,2.636812365743551,2.912771818765612,2.020718548854016,2.749402644458595,2.55278853837901,1.813077624133681,2.098224729972872,3.242112881158103,3.606141362255753,3.549094177818199,1.624059477333209,1.559317709329846,0.8754753036349916,1.421003081943677,3.148043516466952,3.335985919382179,2.368501649764522,3.384758517790571,1.387419825905126,2.357103534517955,0.9407096868668889,1.895540928804837,1.872951316977512,1.665653892199106,2.444103968188061,2.176096002192294,2.476181441234677,3.827458371794849,1.213609512624457,3.340649337174027,3.791751464999924,1.562128761816327,1.459726081343361,1.862128181034507,2.891029829392008,1.661907131960101,1.855121571899435,0.975237143681311,0.9644016618001574,1.661115083921899,1.508060775678981,2.591502358128337,0.5504354617605944,1.047628584383357,1.395814954571885,2.926270930567388,1.948003703431736],[0.0008474048915118179,0.6168860826697395,0.1784234095511638,0.03977584045287483,0.01107072648114416,0.008500869542104206,0.08127068153173776,0.9315679290412588,0.3751834643163258,0.01489551528572576,0.2016484972558217,0.01200836649579053,0.009186702800464012,0.001711138332394331,0.08224894459059771,0.4976751965968165,0.01738456840145934,0.06095689147171243,0.3331352943859202,0.9112399715100833,0.0004249818455240196,0.03905823718456576,0.2109762435313729,0.037610453755154,0.00837238195213401,0.06637757210232645,0.001437976997319889,0.05727863719951489,0.01347030584906751,0.6920280783507746,0.00463743910220837,0.04581800440529835,0.006232952380596524,0.08212244682128127,0.003437221204215499,0.0008480542199578343,0.0548572327332645,0.4711277024317078,0.09434293012731237,0.05709790910835629,0.0001827959849057173,0.0224651528814701,0.2169293424833293,0.0002154289705452835,0.2493544915704118,0.03522114554280838,0.004822522116008625,0.01775195087020661,0.009426754296052857,0.01608849397049465,0.01911057998035294,0.07511034167271033,0.003433347620319845,0.009718202733724835,0.004427778073223887,0.04600937382238555,0.007097819370131119,0.01221362224159964,0.07285006799345162,0.03843100004249049,0.001617276784643553,0.0004889434689291603,0.0005930398956915068,0.1075429638788441,0.1221123432977755,0.3834344891466384,0.158458058611202,0.002172508849442683,0.001197700968768158,0.01980207728138693,0.001022342448660266,0.1684290634070808,0.02038609415796708,0.3491433722371375,0.06093758811304157,0.06402553795233137,0.09894377526585274,0.01629017189249558,0.0319269219169343,0.01497612465363181,0.0002269282980153439,0.2277843167040887,0.001179786799692321,0.0002573583576794577,0.1214487574380139,0.1475313561457579,0.0655509001732691,0.004719852010567067,0.09969481365908869,0.06655450808874351,0.3318196157669163,0.3371944436934379,0.09985416936202615,0.1347236551638779,0.01099985426835149,0.5832606123645301,0.2973607188643158,0.1658927768850277,0.004254900291701173,0.05424648805379499],[99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],[6.202051626012918,-10.21336242584985,-2.912832524427197,0.4424934343382034,3.411686014275082,3.794015474333133,-1.202905087809716,-9.910532309072421,-5.017505698114419,2.492772182320777,-3.354547854728646,3.348469950639171,3.651594259664669,6.401749561506215,-1.081224037926719,-6.987920267113583,2.01040220190766,-0.475884839728468,-5.25433123512762,-10.93414587547133,8.218051917693579,0.5641854629848047,-3.515357694199899,0.6774709212796767,3.257413730159644,-0.6014987485067302,6.246131481138147,-0.2916401328633412,2.64349857941275,-8.157028149474382,4.497522990353914,0.1681076376041629,4.130304229514117,-1.043899448088161,5.128278919268078,7.904165750846216,-0.2010003332660506,-5.852062588245945,-1.376634953493645,-0.3086996750839505,8.49989709259699,1.830887524775294,-4.139703940461062,8.415557376471492,-4.077636499377148,0.7070106869476163,4.098244755932448,2.114083933732475,3.18242444498832,2.26110006387814,2.014089201915977,-0.8668998325943896,5.52362648615663,2.891926283729217,4.460787979085713,0.1799210154334795,4.224663932152986,2.72239683234286,-0.9822816149141883,0.6032326562935333,6.228490463193965,8.250575911620457,8.051875878210581,-1.706127257566836,-2.179657555781646,-5.776079305136435,-2.91945435800175,6.566157555820059,6.654688609694872,1.97674304615749,7.090566013702913,-3.026372277592347,1.924756897873313,-4.780510088249792,-0.480432341430014,-0.4998900235135843,-1.504874581423774,2.264992967727381,0.9329455310297526,2.594804024049234,8.348632650506199,-4.088335247653852,6.176401673632071,9.123046722774426,-2.218050648991025,-2.624318086161114,-0.5779622748210749,4.473660827562312,-1.59174226992153,-0.6260430789684298,-5.376899683983917,-5.814346082973198,-1.552454859332968,-2.24304492707629,3.153661399786357,-7.53669753719227,-5.084904679371429,-2.674872409949475,4.512613956403057,-0.1831800130574538],[23.08577652635188,6.08990920198426,15.46540414891298,18.11803475652346,25.79318510765798,25.2739004365721,20.21404519847581,9.086299425069877,13.19336627621328,22.51734408780259,15.69544641812521,26.46367458338962,25.18402170438857,26.88862033995156,17.68752338338383,14.28549640008425,20.35569803394984,20.78636957079144,15.35716086219543,9.768102201976669,27.82894412076288,21.46619779785616,15.72198679903297,22.50464766467067,21.55666018724882,18.06646260009115,25.38933850827224,18.79798938102887,22.36339215602167,12.24094548648333,24.05026250936267,17.57783773819967,24.34533264567081,17.1355147663751,25.20498126431671,29.4249515197489,19.14923009371567,12.56765491797685,17.13645813841744,20.38365994586206,26.21481843042219,23.5504011677304,18.01380272768716,26.39066000583244,15.52508623014677,19.30301280034356,22.17971170977907,21.7706234538067,22.21239567649478,21.57219205069008,22.08775971145809,17.67905854314506,27.14007201619285,20.47773528707645,23.52518888502952,19.74083645442166,26.13476985028333,21.72378933650393,21.79518117583671,21.60082561544789,25.878250144143,28.43762344169851,28.47094561965856,17.09301960477322,18.17770268739713,14.89779813445501,17.65117125604585,28.95554360731094,26.19108315856078,22.39018693144276,27.18168165101062,17.09764949330599,22.40892253568234,13.39965879995556,21.01990035400089,17.32933931708284,17.24179152741822,21.80995631546035,20.22808308492937,23.52580306523724,26.32294490942779,16.96555987978073,24.24633428633424,29.15265481391767,18.63585525916766,17.23195293149306,18.20840993440381,24.05148965411833,18.00655602701974,18.61872451417846,15.77106664071768,16.81117086263662,17.51526066164088,16.45119025318902,23.76192348417383,13.32344484627954,16.46042818044272,15.36560741874653,23.52215121868613,19.89062753648352],["Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test"],["two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.sim_id<\/th>\n      <th>n<\/th>\n      <th>mean_diff<\/th>\n      <th>sd<\/th>\n      <th>rep<\/th>\n      <th>Source<\/th>\n      <th>estimate<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>parameter<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n      <th>method<\/th>\n      <th>alternative<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,7,8,9,10,11,12]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":".sim_id","targets":1},{"name":"n","targets":2},{"name":"mean_diff","targets":3},{"name":"sd","targets":4},{"name":"rep","targets":5},{"name":"Source","targets":6},{"name":"estimate","targets":7},{"name":"statistic","targets":8},{"name":"p.value","targets":9},{"name":"parameter","targets":10},{"name":"conf.low","targets":11},{"name":"conf.high","targets":12},{"name":"method","targets":13},{"name":"alternative","targets":14}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="a-complete-solution-with-varying-parameters" class="level3">
<h3 class="anchored" data-anchor-id="a-complete-solution-with-varying-parameters">A complete solution with varying parameters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sim_vary <span class="ot">&lt;-</span> <span class="fu">specify</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre  =</span> <span class="sc">~</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sd),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> <span class="sc">~</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(n, mean_diff, sd)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">100</span>, <span class="at">.progress =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">t =</span> <span class="sc">~</span><span class="fu">t.test</span>(post, pre, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_fits</span>()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>sim_vary <span class="sc">|&gt;</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(n, mean_diff, sd) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Power =</span> <span class="fu">mean</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, Power)) <span class="sc">+</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(sd), <span class="at">cols =</span> <span class="fu">vars</span>(mean_diff)) <span class="sc">+</span> </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'n', 'mean_diff'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="simulator_files/figure-html/simpr-vary-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="philosophy" class="level3">
<h3 class="anchored" data-anchor-id="philosophy">Philosophy</h3>
<p>The <a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a> workflow, inspired by the <a href="https://infer.tidymodels.org"><strong>infer</strong></a> package, distills a simulation study into five primary steps:</p>
<ul>
<li><code>specify()</code> your data-generating process;</li>
<li><code>define()</code> parameters that you want to systematically vary across your simulation design (e.g.&nbsp;n, effect size);</li>
<li><code>generate()</code> the simulation data;</li>
<li><code>fit()</code> models to your data (e.g.&nbsp;<code>lm()</code>);</li>
<li><code>tidy_fits()</code> for consolidating results using <code>broom::tidy()</code>, such as computing power or Type I Error rates.</li>
</ul>
</section>
<section id="reproducible-workflows" class="level3">
<h3 class="anchored" data-anchor-id="reproducible-workflows">Reproducible workflows</h3>
<ul>
<li>Same seed, same results;</li>
<li>Can regenerate just a <em>specific subset</em> to see what happened in that particular dataset or fit;</li>
<li>Useful in debugging and diagnosing unexpected results, etc.</li>
</ul>
<section id="filtering-full-simulation" class="level4">
<h4 class="anchored" data-anchor-id="filtering-full-simulation">Filtering full simulation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">500</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.sim_id <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>full tibble
--------------------------
# A tibble: 1 × 3
  .sim_id   rep sim             
    &lt;int&gt; &lt;int&gt; &lt;list&gt;          
1       3     3 &lt;tibble [6 × 1]&gt;

sim[[1]]
--------------------------
# A tibble: 6 × 1
      a
  &lt;dbl&gt;
1 0.371
2 0.959
3 0.633
4 0.177
5 0.803
6 0.133</code></pre>
</div>
</div>
</section>
<section id="simulate-subset-only" class="level4">
<h4 class="anchored" data-anchor-id="simulate-subset-only">Simulate subset only</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">500</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">3</span>, .sim_id <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>full tibble
--------------------------
# A tibble: 1 × 3
  .sim_id   rep sim             
    &lt;int&gt; &lt;int&gt; &lt;list&gt;          
1       3     3 &lt;tibble [6 × 1]&gt;

sim[[1]]
--------------------------
# A tibble: 6 × 1
      a
  &lt;dbl&gt;
1 0.371
2 0.959
3 0.633
4 0.177
5 0.803
6 0.133</code></pre>
</div>
</div>
</section>
<section id="benchmarking" class="level4">
<h4 class="anchored" data-anchor-id="benchmarking">Benchmarking</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">500</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate</span>(<span class="dv">1000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(.sim_id <span class="sc">==</span> <span class="dv">1000</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> <span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate</span>(<span class="dv">1000</span>, .sim_id <span class="sc">==</span> <span class="dv">1000</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">check =</span> <span class="cn">FALSE</span>, <span class="at">min_iterations =</span> 10L, <span class="at">relative =</span> <span class="cn">TRUE</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Some expressions had a GC in every iteration; so filtering is
disabled.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  expression   min median `itr/sec` mem_alloc `gc/sec`
  &lt;bch:expr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 all         63.2   58.7       1        1        1   
2 subset       1      1        61.8      1.29     1.49</code></pre>
</div>
</div>
</section>
</section>
<section id="other-features" class="level3">
<h3 class="anchored" data-anchor-id="other-features">Other features</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data munging
</div>
</div>
<div class="callout-body-container callout-body">
<p>Add <code>per_sim() |&gt;</code> after <code>generate()</code> in your simulation pipeline and then any tidyverse function that will apply to every simulation dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre  =</span> <span class="sc">~</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sd), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> <span class="sc">~</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(n, mean_diff, sd)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>), </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">1000</span>, <span class="at">.progress =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Apply tidyverse functions to every simulation dataset</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">per_sim</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mutate to add a range restriction</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    pre <span class="sc">&gt;</span>  <span class="dv">100</span> <span class="sc">~</span> <span class="dv">100</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    pre <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">100</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">100</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    .default   <span class="sc">~</span> pre</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">|&gt;</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">t =</span> <span class="sc">~</span> <span class="fu">t.test</span>(post, pre, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_fits</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Error handling
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Can change error handling to keep going with simulation, stop simulation, or to skip warnings;</li>
<li>Debug and recovery options to enter into simulation during error.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Built-in parallelization
</div>
</div>
<div class="callout-body-container callout-body">
<p>Just add</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">6</span>) <span class="co"># or however many cores are reasonable to use</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and your simulation pipeline (actually the <code>generate()</code> function) will run in parallel.</p>
</div>
</div>
</section>
<section id="pros-cons" class="level3">
<h3 class="anchored" data-anchor-id="pros-cons">Pros &amp; Cons</h3>
<div class="columns">
<div class="column">
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pros
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>tidyverse friendly;</li>
<li>beginner friendly;</li>
<li>Reproducibility, error handling built in;</li>
<li>General-purpose, customizable and can handle arbitrary R code.</li>
</ul>
</div>
</div>
</div><div class="column">
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cons
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Likely not as fast/optimized as some alternatives;</li>
<li>Not as customizable/powerful as <strong>DeclareDesign</strong>;</li>
<li>Not specifically set up for any particular application (no MC errors, plots, reports, specific models…).</li>
</ul>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="simulator" class="level1">
<h1>Simulator</h1>
<p>This is a package on the CRAN. It is described in a 2016 paper by Jacob Bien. Last update on GitHub : last year (so, 2023).</p>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<p>The function “create”, with a directory that does not exist, will create the directory with 5 files :</p>
<ul>
<li>eval_functions.R : contains metrics to be evaluated</li>
<li>main.R : main code to run</li>
<li>method_functions.R : methods to run</li>
<li>model_functions.R : define the models.</li>
<li>writeup.Rmd</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simulator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'simulator'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:simpr':

    rename</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"./sims_simulator"</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(dir)) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create</span>(dir)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(dir)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "eval_functions.R"   "files"              "main.R"            
[4] "method_functions.R" "model_functions.R"  "writeup.Rmd"       </code></pre>
</div>
</div>
<p>“On a typical project, one starts by defining a model in model_functions.R, one or two methods in method_functions.R, and a few metrics in eval_functions.R, and then one runs the code in main.R. After looking at some of the results, one might add an additional model or method or metric. One then returns to main.R, adds some additional lines specifying that the additional components should be run as well and looks at some more results.</p>
<p>The simplest way to look at results is by using the plot functions “plot_eval”, “plot_evals” and “plot_evals_by.” In situations where you wish to investigate results more deeply than just looking at aggregated plots, one can use the functions “model”, “draws”, “output”, and “evals” to get at all objects generated through the course of the simulation.”</p>
<p>The “create” function also create the template in the different files :</p>
<section id="what-is-in-model_functions" class="level3">
<h3 class="anchored" data-anchor-id="what-is-in-model_functions">what is in model_functions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>make_my_model <span class="ot">&lt;-</span> <span class="cf">function</span>(n, prob) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_model</span>(<span class="at">name =</span> <span class="st">"contaminated-normal"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"Contaminated normal (n = %s, prob = %s)"</span>, n, prob),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">params =</span> <span class="fu">list</span>(<span class="at">n =</span> n, <span class="at">mu =</span> <span class="dv">2</span>, <span class="at">prob =</span> prob),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">simulate =</span> <span class="cf">function</span>(n, mu, prob, nsim) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>              <span class="co"># this function must return a list of length nsim</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>              contam <span class="ot">&lt;-</span> <span class="fu">runif</span>(n <span class="sc">*</span> nsim) <span class="sc">&lt;</span> prob</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>              x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n <span class="sc">*</span> nsim), n, nsim)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>              x[contam] <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="fu">sum</span>(contam))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>              x[<span class="sc">!</span>contam] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">sum</span>(<span class="sc">!</span>contam))</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>              x <span class="ot">&lt;-</span> mu <span class="sc">+</span> x <span class="co"># true mean is mu</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">return</span>(<span class="fu">split</span>(x, <span class="fu">col</span>(x))) <span class="co"># make each col its own list element</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define a model from its different components with “new_model” :</p>
<ul>
<li>name</li>
<li>label : what will be printed in the tables later probably ?</li>
<li>param : a list of different parameters for the model</li>
<li>simulate : a function of the parameters, that returns nsim simulations.</li>
</ul>
</section>
<section id="what-is-in-method_functions" class="level3">
<h3 class="anchored" data-anchor-id="what-is-in-method_functions">what is in method_functions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>my_method <span class="ot">&lt;-</span> <span class="fu">new_method</span>(<span class="st">"my-method"</span>, <span class="st">"My Method"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="cf">function</span>(model, draw) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(<span class="at">fit =</span> <span class="fu">median</span>(draw))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                        })</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>their_method <span class="ot">&lt;-</span> <span class="fu">new_method</span>(<span class="st">"their-method"</span>, <span class="st">"Their Method"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="cf">function</span>(model, draw) {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">list</span>(<span class="at">fit =</span> <span class="fu">mean</span>(draw))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                           })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define methods to be used on the model. The function “new_method” has for arguments a name (for R), a pretty name, and the “method” named arg for the computation we want.</p>
</section>
<section id="what-is-in-eval_functions" class="level3">
<h3 class="anchored" data-anchor-id="what-is-in-eval_functions">what is in eval_functions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>his_loss <span class="ot">&lt;-</span> <span class="fu">new_metric</span>(<span class="st">"hisloss"</span>, <span class="st">"His loss function"</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="cf">function</span>(model, out) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">return</span>((model<span class="sc">$</span>mu <span class="sc">-</span> out<span class="sc">$</span>fit)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>her_loss <span class="ot">&lt;-</span> <span class="fu">new_metric</span>(<span class="st">"herloss"</span>, <span class="st">"Her loss function"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="cf">function</span>(model, out) {</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">return</span>(<span class="fu">abs</span>(model<span class="sc">$</span>mu <span class="sc">-</span> out<span class="sc">$</span>fit))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                        })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Metric objects : shows how to compare model object and output of the method (method used on sim) object.</p>
</section>
<section id="what-is-in-main" class="level3">
<h3 class="anchored" data-anchor-id="what-is-in-main">what is in main</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(dir)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the main simulator file</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simulator) <span class="co"># this file was created under simulator version 0.2.5</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"model_functions.R"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"method_functions.R"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"eval_functions.R"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="do">## @knitr init</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>name_of_simulation <span class="ot">&lt;-</span> <span class="st">"normal-mean-estimation-with-contamination"</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="do">## @knitr main</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">new_simulation</span>(<span class="at">name =</span> name_of_simulation,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> <span class="st">"Mean estimation under contaminated normal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_model</span>(make_my_model, <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prob =</span> <span class="fu">as.list</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">6</span>)),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vary_along =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_from_model</span>(<span class="at">nsim =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_method</span>(<span class="fu">list</span>(my_method, their_method)) <span class="sc">%&gt;%</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate</span>(<span class="fu">list</span>(his_loss, her_loss))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>..Created model and saved in contaminated-normal/n_50/prob_0/model.Rdata
..Created model and saved in contaminated-normal/n_50/prob_0.2/model.Rdata
..Created model and saved in contaminated-normal/n_50/prob_0.4/model.Rdata
..Created model and saved in contaminated-normal/n_50/prob_0.6/model.Rdata
..Created model and saved in contaminated-normal/n_50/prob_0.8/model.Rdata
..Created model and saved in contaminated-normal/n_50/prob_1/model.Rdata
..Simulated 10 draws in 0 sec and saved in contaminated-normal/n_50/prob_0/r1.Rdata
..Simulated 10 draws in 0 sec and saved in contaminated-normal/n_50/prob_0.2/r1.Rdata
..Simulated 10 draws in 0 sec and saved in contaminated-normal/n_50/prob_0.4/r1.Rdata
..Simulated 10 draws in 0 sec and saved in contaminated-normal/n_50/prob_0.6/r1.Rdata
..Simulated 10 draws in 0 sec and saved in contaminated-normal/n_50/prob_0.8/r1.Rdata
..Simulated 10 draws in 0 sec and saved in contaminated-normal/n_50/prob_1/r1.Rdata
..Performed My Method in 0 seconds (on average over 10 sims)
..Performed Their Method in 0 seconds (on average over 10 sims)
..Performed My Method in 0 seconds (on average over 10 sims)
..Performed Their Method in 0 seconds (on average over 10 sims)
..Performed My Method in 0 seconds (on average over 10 sims)
..Performed Their Method in 0 seconds (on average over 10 sims)
..Performed My Method in 0 seconds (on average over 10 sims)
..Performed Their Method in 0 seconds (on average over 10 sims)
..Performed My Method in 0 seconds (on average over 10 sims)
..Performed Their Method in 0 seconds (on average over 10 sims)
..Performed My Method in 0 seconds (on average over 10 sims)
..Performed Their Method in 0 seconds (on average over 10 sims)
..Evaluated My Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated Their Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated My Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated Their Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated My Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated Their Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated My Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated Their Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated My Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated Their Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated My Method in terms of 
His loss function, Her loss function, Computing time (sec)
..Evaluated Their Method in terms of 
His loss function, Her loss function, Computing time (sec)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## @knitr plots</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_eval_by</span>(sim, <span class="st">"hisloss"</span>, <span class="at">varying =</span> <span class="st">"prob"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="simulator_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## @knitr tables</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tabulate_eval</span>(sim, <span class="st">"herloss"</span>, <span class="at">output_type =</span> <span class="st">"markdown"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">format_args =</span> <span class="fu">list</span>(<span class="at">digits =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;!-- generated by simulator on Tue Aug 20 14:03:28 2024. --&gt;</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>A comparison of Mean Her loss function (averaged over 10 replicates).</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">My Method</th>
<th style="text-align: left;">Their Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Contaminated normal (n = 50, prob = 0)</td>
<td style="text-align: left;">0.11 (0.02)</td>
<td style="text-align: left;">0.07 (0.02)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Contaminated normal (n = 50, prob = 0.2)</td>
<td style="text-align: left;">0.25 (0.05)</td>
<td style="text-align: left;">0.25 (0.06)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Contaminated normal (n = 50, prob = 0.4)</td>
<td style="text-align: left;">0.38 (0.06)</td>
<td style="text-align: left;">0.37 (0.06)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Contaminated normal (n = 50, prob = 0.6)</td>
<td style="text-align: left;">0.52 (0.04)</td>
<td style="text-align: left;">0.63 (0.06)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Contaminated normal (n = 50, prob = 0.8)</td>
<td style="text-align: left;">0.63 (0.04)</td>
<td style="text-align: left;">0.86 (0.03)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Contaminated normal (n = 50, prob = 1)</td>
<td style="text-align: left;">0.70 (0.05)</td>
<td style="text-align: left;">1.03 (0.05)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>main calls the different files.</p>
<p>? Can plot_eval_by be used for different metrics at once ? ? Can tabulate_eval be used for different metrics at once ?</p>
</section>
</section>
<section id="important-functions" class="level2">
<h2 class="anchored" data-anchor-id="important-functions">Important functions :</h2>
<ul>
<li>new_model()</li>
<li>new_method()</li>
<li>new_metric()</li>
<li>new_simulation</li>
<li>generate_model</li>
<li>simulate_from_model</li>
<li>run_method</li>
<li>evaluate</li>
<li>plot_eval, plot_eval_by, tabulate_eval.</li>
</ul>
</section>
<section id="final-notes" class="level2">
<h2 class="anchored" data-anchor-id="final-notes">Final notes :</h2>
<p>This is not really a package that codes a method, but instead it proposes an architecture to store your codes, output simulations, results, etc.</p>
<p>PROs :</p>
<ul>
<li><p>any model possible, if you can write it !</p></li>
<li><p>possible to iterate over parameter with pretty pipes</p></li>
<li><p>parallel possible, because you choose what you use</p></li>
<li><p>stores all results in the storage with increasing depth:</p></li>
<li><p><em>files</em></p>
<ul>
<li><p><em>name_of_model</em></p>
<ul>
<li><p><em>name_of_first_param_value</em></p>
<ul>
<li><p><em>name_of2nd_param_value … model.Rdata</em> out : stores all sims</p>
<ul>
<li><em>r?.Rdata</em></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>CONs :</p>
<ul>
<li>Not an usual way to code in R, and not easy to explain. create the directory with the “create” function. Then, add the different functions, methods, models… in the corresponding files.</li>
<li>Mixes the code of the package/template with your own code.</li>
<li>stores all results in this neat way BUT if too many parameters, may exceed the depth allowed.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>