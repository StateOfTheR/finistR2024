<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Julie Aubert">
<meta name="author" content="Caroline Cognot">
<meta name="author" content="Annaïg De Walsche">
<meta name="author" content="Cédric Midoux">
<meta name="author" content="Aymeric Stamm">
<meta name="author" content="Florian Teste">
<meta name="dcterms.date" content="2024-08-19">

<title>Setting up simulations in R – Finist’R 2024</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Finist’R 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/StateOfTheR/finistR2024"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./instructions.html"> 
<span class="menu-text">Instructions</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-themes-to-be-developped" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Themes to be developped</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-themes-to-be-developped">    
        <li>
    <a class="dropdown-item" href="./theme.qmd">
 <span class="dropdown-text">List to discussed</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#list-of-packages-for-data-simulation" id="toc-list-of-packages-for-data-simulation" class="nav-link active" data-scroll-target="#list-of-packages-for-data-simulation">List of packages for data simulation</a></li>
  <li><a href="#how-to-choose" id="toc-how-to-choose" class="nav-link" data-scroll-target="#how-to-choose">How to choose ?</a></li>
  <li><a href="#simpr" id="toc-simpr" class="nav-link" data-scroll-target="#simpr"><strong>simpr</strong></a>
  <ul class="collapse">
  <li><a href="#usual-base-r-solution" id="toc-usual-base-r-solution" class="nav-link" data-scroll-target="#usual-base-r-solution">Usual base R solution</a></li>
  <li><a href="#solution-via-simpr" id="toc-solution-via-simpr" class="nav-link" data-scroll-target="#solution-via-simpr">Solution via <strong>simpr</strong></a></li>
  <li><a href="#a-complete-solution-with-varying-parameters" id="toc-a-complete-solution-with-varying-parameters" class="nav-link" data-scroll-target="#a-complete-solution-with-varying-parameters">A complete solution with varying parameters</a></li>
  <li><a href="#philosophy" id="toc-philosophy" class="nav-link" data-scroll-target="#philosophy">Philosophy</a></li>
  <li><a href="#reproducible-workflows" id="toc-reproducible-workflows" class="nav-link" data-scroll-target="#reproducible-workflows">Reproducible workflows</a></li>
  <li><a href="#other-features" id="toc-other-features" class="nav-link" data-scroll-target="#other-features">Other features</a></li>
  <li><a href="#pros-cons" id="toc-pros-cons" class="nav-link" data-scroll-target="#pros-cons">Pros &amp; Cons</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Setting up simulations in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Julie Aubert </p>
             <p>Caroline Cognot </p>
             <p>Annaïg De Walsche </p>
             <p>Cédric Midoux </p>
             <p>Aymeric Stamm </p>
             <p>Florian Teste </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="list-of-packages-for-data-simulation" class="level2">
<h2 class="anchored" data-anchor-id="list-of-packages-for-data-simulation">List of packages for data simulation</h2>
<ul>
<li><a href="https://jacobbien.github.io/simulator/"><strong>simulator</strong></a></li>
<li><a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></li>
<li><a href="https://declaredesign.org/r/declaredesign/"><strong>DeclareDesign</strong></a></li>
<li><a href="https://github.com/FunWithR/MonteCarlo"><strong>MonteCarlo</strong></a></li>
<li><a href="https://yu-group.github.io/simChef/index.html"><strong>simChef</strong></a></li>
<li><a href="https://cran.r-project.org/web/packages/SimEngine/vignettes/SimEngine.html"><strong>simEngine</strong></a></li>
</ul>
</section>
<section id="how-to-choose" class="level2">
<h2 class="anchored" data-anchor-id="how-to-choose">How to choose ?</h2>
<ul>
<li>Number of dependencies</li>
<li>Number of reverse dependencies</li>
<li>Date of latest commit</li>
<li>Date of last release</li>
<li>Is it on CRAN or only on Github?</li>
<li>Who developed it?</li>
<li>Philosophy</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Version</th>
<th>Number of dependencies</th>
<th>Number of reverse dependencies</th>
<th>Date of latest commit</th>
<th>Date of latest release</th>
<th>Documentation quality</th>
<th>On CRAN?</th>
<th>Developers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://declaredesign.org/r/declaredesign/"><strong>DeclareDesign</strong></a></td>
<td>1.0.10</td>
<td>2</td>
<td>1</td>
<td>2024-04-13</td>
<td>2024-04-21</td>
<td></td>
<td>Yes</td>
<td>Graeme Blair</td>
</tr>
<tr class="even">
<td><a href="https://github.com/FunWithR/MonteCarlo"><strong>MonteCarlo</strong></a></td>
<td>1.0.6</td>
<td>6</td>
<td>0</td>
<td>2019-01-31</td>
<td>2019-01-31</td>
<td></td>
<td>Yes</td>
<td>Christian Hendrik Leschinski</td>
</tr>
<tr class="odd">
<td><a href="https://yu-group.github.io/simChef/index.html"><strong>simChef</strong></a></td>
<td>0.1.0</td>
<td>22</td>
<td>0</td>
<td>2024-03-20</td>
<td>NA</td>
<td></td>
<td>No</td>
<td>Tiffany Tang, James Duncan</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/SimEngine/vignettes/SimEngine.html"><strong>simEngine</strong></a></td>
<td>1.4.0</td>
<td>6</td>
<td>0</td>
<td>2024-04-13</td>
<td>2024-04-04</td>
<td></td>
<td>Yes</td>
<td>Avi Kenny, Charles Wolock</td>
</tr>
<tr class="odd">
<td><a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></td>
<td>0.2.6</td>
<td>11</td>
<td>0</td>
<td>2024-07-16</td>
<td>2023-04-26</td>
<td></td>
<td>Yes</td>
<td>Ethan Brown</td>
</tr>
<tr class="even">
<td><a href="https://jacobbien.github.io/simulator/"><strong>simulator</strong></a></td>
<td>0.2.5</td>
<td>1</td>
<td>0</td>
<td>2023-02-02</td>
<td>2023-02-04</td>
<td></td>
<td>Yes</td>
<td>Jacob Bien</td>
</tr>
</tbody>
</table>
</section>
<section id="simpr" class="level2">
<h2 class="anchored" data-anchor-id="simpr"><a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Problem
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Study: Pre-post comparison of the “Triglicious” intervention;</li>
<li>Research question: Did Triglicious improve students’ math scores?</li>
<li>Method: Paired t-test</li>
</ul>
</div>
</div>
<section id="usual-base-r-solution" class="level3">
<h3 class="anchored" data-anchor-id="usual-base-r-solution">Usual base R solution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set up parameters</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>L, <span class="dv">150</span>L, <span class="dv">200</span>L)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mean_diffs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">10</span>L</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Bring together into data frame</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>results_template <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> ns, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_diff =</span> mean_diffs, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> sds, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.value =</span> <span class="cn">NA_real_</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>base_r_sim <span class="ot">&lt;-</span> results_template[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(results_template), <span class="at">each =</span> reps), ]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop over rows of the data frame and calculate the p-value</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(results_template)) {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> base_r_sim[i,]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  pre <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(params<span class="sc">$</span>n, <span class="dv">0</span>, params<span class="sc">$</span>sd)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(params<span class="sc">$</span>n, params<span class="sc">$</span>mean_diff, params<span class="sc">$</span>sd)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  base_r_sim<span class="sc">$</span>p.value[i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(pre, post)<span class="sc">$</span>p.value</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Display table output</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(base_r_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-cd90a13cd18cac18a72e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cd90a13cd18cac18a72e">{"x":{"filter":"none","vertical":false,"data":[["1","1.1","1.2","1.3","1.4","1.5","1.6","1.7","1.8","1.9","2","2.1","2.2","2.3","2.4","2.5","2.6","2.7","2.8","2.9","3","3.1","3.2","3.3","3.4","3.5","3.6","3.7","3.8","3.9","4","4.1","4.2","4.3","4.4","4.5","4.6","4.7","4.8","4.9","5","5.1","5.2","5.3","5.4","5.5","5.6","5.7","5.8","5.9","6","6.1","6.2","6.3","6.4","6.5","6.6","6.7","6.8","6.9","7","7.1","7.2","7.3","7.4","7.5","7.6","7.7","7.8","7.9","8","8.1","8.2","8.3","8.4","8.5","8.6","8.7","8.8","8.9","9","9.1","9.2","9.3","9.4","9.5","9.6","9.7","9.8","9.9","10","10.1","10.2","10.3","10.4","10.5","10.6","10.7","10.8","10.9","11","11.1","11.2","11.3","11.4","11.5","11.6","11.7","11.8","11.9","12","12.1","12.2","12.3","12.4","12.5","12.6","12.7","12.8","12.9","13","13.1","13.2","13.3","13.4","13.5","13.6","13.7","13.8","13.9","14","14.1","14.2","14.3","14.4","14.5","14.6","14.7","14.8","14.9","15","15.1","15.2","15.3","15.4","15.5","15.6","15.7","15.8","15.9","16","16.1","16.2","16.3","16.4","16.5","16.6","16.7","16.8","16.9","17","17.1","17.2","17.3","17.4","17.5","17.6","17.7","17.8","17.9","18","18.1","18.2","18.3","18.4","18.5","18.6","18.7","18.8","18.9"],[100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,150,150,150,150,150,150,150,150,150,150,200,200,200,200,200,200,200,200,200,200],[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],[0.137402158053849,0.06998126017749309,0.2383197896697321,0.03719135898117774,0.3072718801851996,0.3048778146664409,0.7333386484983946,0.9750519061917058,0.4108340883648732,0.4728150916217169,0.1002989789331292,0.0873016484074501,0.02790921687666667,0.06405708710519135,0.01410967099164922,0.02004463740955748,0.1338132986640393,0.6985864532647786,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>n<\/th>\n      <th>mean_diff<\/th>\n      <th>sd<\/th>\n      <th>p.value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"n","targets":1},{"name":"mean_diff","targets":2},{"name":"sd","targets":3},{"name":"p.value","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>What <a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a> author advocates is bad:</p>
<ul>
<li>Most important pieces (data generating process, model specification, definitions, varying parameters) are hidden;</li>
<li>What if there is an error?</li>
<li>What about parallelization?</li>
<li>Is this code sufficiently readable? Without the comments?</li>
</ul>
</section>
<section id="solution-via-simpr" class="level3">
<h3 class="anchored" data-anchor-id="solution-via-simpr">Solution via <a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specify pre and post scores that differ by a given amount</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre  =</span> <span class="sc">~</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sd), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> <span class="sc">~</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(n, mean_diff, sd)) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Define parameters that can be varied</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean_diff =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Generate datasets</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fit datasets</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">t =</span> <span class="sc">~</span><span class="fu">t.test</span>(post, pre, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Collect results</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_fits</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-97406a77c3db02d1398f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-97406a77c3db02d1398f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],[50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],["t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t","t"],[7.863842851532403,6.521396321287351,9.023611387991775,9.153390265073728,13.463648192185,1.024042685392426,3.98933445778382,8.150211215261292,14.33114021825257,16.12889136643274,14.26937548862351,12.20865527739163,11.66043357286725,12.75966367472641,14.81331207278933,7.679533569399264,-2.380558000823124,3.669750857760482,16.74810241118047,5.348737635001594,17.51066723242248,11.6085675401721,11.13926935860837,13.11965122634229,10.7184464454738,5.029196608994122,14.577056946529,18.46589536300967,6.055304476114095,13.08059647528798,12.57071771983773,16.40599598874679,7.420372836356396,9.091632709073833,8.037734527640255,9.88907847145682,4.768400964507968,21.48022853491005,11.59964639787117,6.195429101571087,17.5133331095097,7.179583730240414,12.75469441654249,20.81452043139249,15.07392856027535,7.467879329624415,7.050711416617818,10.59105666460095,6.924589071766831,11.75503140388514,19.81063463555922,2.657347136281246,17.48364616483017,15.1481213211275,8.489052836517555,12.02817882088609,15.58330840003967,13.18949532830178,15.46941371157546,0.2814878984322151,15.62911436950172,4.282365849431071,0.6271286880511704,14.02424723821276,4.747529964827862,6.072642679629174,7.267620877653178,11.92876278548719,19.2060831831289,9.969730199348739,13.96636674933003,2.998161252310688,0.1617877557954742,2.076964394617667,7.171221413419537,1.768047972090477,3.559330912232842,12.26918534873897,14.707140348471,4.202721835689212,7.786574987245121,11.86909894965073,9.997174473100625,7.81691039706354,10.72835457115392,6.749219054553175,8.188330804644645,2.899633200776213,5.839825495643127,-1.672277054402402,6.337624499119936,4.508018465801211,20.11996236795488,9.617639197756928,14.40904193221436,10.54578154669487,-0.8197297778262755,10.77980563155081,4.594897401709888,4.15119565907644],[1.734562462455996,1.292277013781721,1.801348534247029,1.944318456198248,2.832573346298037,0.2303767727300118,0.8422886676424498,1.516000194475721,2.855295034913641,3.124397842106526,2.75966404204544,2.513329876180983,2.136305569561763,2.426338735765646,3.001050525855821,1.633036915610278,-0.4624141231593633,0.6788978525916074,3.26667568995878,1.133379813451747,3.19817686953439,2.223286008206273,2.079428355522348,2.403238154484913,2.028607450976822,0.8739944185634303,2.819246489583948,4.009905402543055,1.21803506415226,2.519780779231708,2.262259229481556,3.3209787043678,1.558715043821994,1.910574877645715,1.759781117109821,1.948279679895274,0.9059946115894143,4.068909458971152,2.026231674685454,1.154038136230016,3.197799228223122,1.394393984774076,2.624052786615406,4.525203534565584,2.755468462644417,1.379709776929433,1.429982962623523,1.970025554885179,1.464941033279956,2.457515295362556,4.239204286457866,0.5457750426739495,3.949565170349413,3.077735754722545,1.782251212196047,2.380171156437612,3.15936122746204,2.69601108349746,2.869775445799375,0.05667609267969773,3.385830273718148,0.8212909411999199,0.1243573552505378,2.823053551839148,1.043092382572539,1.187030278749126,1.434318365754865,2.5152486410104,3.394944575276011,1.861836251132184,2.691721733774854,0.5857557522682134,0.03569360440230229,0.3956767857123569,1.451942727783441,0.3729154699131504,0.7795719420193961,2.372955814444097,3.285877216301625,0.9022767028354378,1.464534358750397,2.362444775321514,1.916490030683207,1.555939694474949,1.962493497761649,1.233266166190531,1.646444303533763,0.5548643401698622,1.26292515353031,-0.3227704445250489,1.47172214629316,0.9687976165232797,4.278663060516263,1.975173820984891,2.742372423853291,2.245018950215243,-0.1673792211481601,2.006782946572457,1.045415331384612,0.7381407499203598],[0.08593071426544517,0.199269498174387,0.07469213484342434,0.05469528114070782,0.005595102937974074,0.8182743878550252,0.4016566012945273,0.13270588528128,0.005238594693501014,0.002337639053371753,0.006894341867729054,0.0135734311570847,0.03511980103682164,0.01706134802225901,0.003404738595982921,0.105637830534023,0.6447990739765088,0.498786635367415,0.00149587960508532,0.2597920252709604,0.001857670123574185,0.02847032231669082,0.04016241477216243,0.01811268160080612,0.04518362958693075,0.3842364977902785,0.0058144089319526,0.000117925206130537,0.2261056162216318,0.013342227788031,0.02586694390871958,0.001257096568576095,0.1222549842638292,0.05895267619356748,0.08153385574225935,0.05421300527273244,0.3671384629230819,9.503830299834382e-05,0.04543096086247926,0.2512628519041789,0.001859873846472919,0.1663200092824281,0.01006472059656065,1.680872590514746e-05,0.006976886138356867,0.1707843082506963,0.1558703155372405,0.051629178767357,0.1461055979893374,0.01572875259005922,5.04358624545726e-05,0.586448284706927,0.0001467404991730163,0.002698255276143788,0.07777393326962599,0.01921956649377077,0.00209737302237889,0.008247587324501968,0.005022391395217227,0.9549174494900714,0.001018774617018371,0.4134539654787306,0.9012844883327129,0.005750970730921964,0.2994459694539237,0.2380562041412045,0.1546326872133553,0.01350428908853251,0.0009889027796639305,0.06559246111126897,0.008346930044486837,0.5593726448866507,0.9715985415534489,0.6931948708568932,0.1496793614121627,0.7100085928409247,0.4375025592799201,0.01957791553366755,0.001406972715020751,0.3690999063735729,0.1462163957893871,0.02011054666333702,0.05818678349885845,0.1229135705016124,0.05251203432754752,0.2203966956908098,0.1028433092298313,0.5802389316459584,0.2095825354863967,0.7475497960465411,0.1442676925211848,0.3350070632036676,4.345166408093678e-05,0.05103301653485359,0.007240368107798116,0.02699164092571371,0.8674130993889398,0.0474995762721195,0.2983768969247527,0.462175095855119],[99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],[-1.13183797770041,-3.491832259513929,-0.9160545568142915,-0.1878326557632199,4.032365853796991,-7.795956099315891,-5.408518512075521,-2.517193255569851,4.37206733474627,5.885887345538109,4.009598826790166,2.570198747250482,0.8301336907783732,2.325036148597273,5.019133444095216,-1.65146228441122,-12.59552182414914,-7.055841854413548,6.575109477318412,-4.01533940165921,6.646676848669914,1.248264631852684,0.5100370357252255,2.287501980696928,0.2345437458463344,-6.38851608169949,4.317562572976774,9.328437261811633,-3.808974592801742,2.780199918155076,1.545000212200024,6.603748444757457,-2.025631824564288,-0.3504320589771047,-1.025102291684447,-0.1824104123607586,-5.674864265446388,11.00532512093832,0.2405233012305741,-4.456797250192191,6.646405590117555,-3.036934627148536,3.110040542695894,11.68774326797025,4.219170111108967,-3.271982781971289,-2.732720609684017,-0.07629438422254477,-2.454550911913353,2.26392767727394,10.53799892155674,-7.003690510705582,8.700059719356787,5.382124008347009,-0.9619843830761796,2.00095189287148,5.796309553441574,3.482257708441709,4.773568863317172,-9.573338595909236,6.469897526599301,-6.063715526946257,-9.379190368431829,4.167137342025325,-4.283433727135268,-4.078269863684282,-2.786309189367494,2.518459189851919,7.980852555484589,-0.6553221661647622,3.67098542949725,-7.157953062210669,-8.832036571674159,-8.338475955824638,-2.628930355520525,-7.63942112072283,-5.50010844375957,2.009944362059781,5.826054638992691,-5.039578096217432,-2.763026660662528,1.900244827865643,-0.3532905644982178,-2.151628983969204,-0.1187555094618269,-4.109681663838463,-1.679858937881906,-7.469570465477789,-3.335287305278332,-11.9525258670744,-2.206938070395296,-4.72495909870585,10.78939115187043,-0.04403337388316585,3.983519487000056,1.225094738829407,-10.53731425292253,0.1212174142936279,-4.126299850292978,-7.007750377949862],[16.85952368076521,16.53462490208863,18.96327733279784,18.49461318591068,22.89493053057301,9.844041470100741,13.38718742764316,18.81761568609243,24.29021310175887,26.37189538732736,24.52915215045686,21.84711180753279,22.49073345495612,23.19429120085555,24.60749070148345,17.01052942320975,7.834405822502887,14.39534356993451,26.92109534504253,14.7128146716624,28.37465761617505,21.96887044849151,21.76850168149151,23.95180047198765,21.20234914510126,16.44690929968773,24.83655132008122,27.6033534642077,15.91958354502993,23.38099303242089,23.59643522747544,26.20824353273612,16.86637749727708,18.53369747712477,17.10057134696496,19.9605673552744,15.21166619446233,31.95513194888178,22.95876949451177,16.84765545333436,28.38026062890184,17.39610208762936,22.39934829038908,29.94129759481474,25.92868700944173,18.20774144122012,16.83414344291965,21.25840771342444,16.30372905544701,21.24613513049634,29.0832703495617,12.31838478326807,26.26723261030355,24.914118633908,17.94009005611129,22.05540574890071,25.37030724663776,22.89673294816184,26.16525855983376,10.13631439277366,24.78833121240415,14.6284472258084,10.63344774453417,23.88135713440019,13.77849365679099,16.22355522294263,17.32155094467385,21.33906638112245,30.43131381077321,20.59478256486224,24.26174806916281,13.15427556683204,9.155612083265106,12.49240474505997,16.9713731823596,11.17551706490378,12.61877026822525,22.52842633541815,23.5882260579493,13.44502176759586,18.33617663515277,21.83795307143583,20.34763951069947,17.78544977809629,21.57546465176967,17.60811977294481,18.0565205471712,13.26883686703022,15.01493829656459,8.607971758269599,14.88218706863517,13.74099603030827,29.45053358403934,19.27931176939702,24.83456437742866,19.86646835456034,8.897854697269979,21.43839384880799,13.31609465371275,15.31014169610274],["Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test","Paired t-test"],["two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided","two.sided"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.sim_id<\/th>\n      <th>n<\/th>\n      <th>mean_diff<\/th>\n      <th>sd<\/th>\n      <th>rep<\/th>\n      <th>Source<\/th>\n      <th>estimate<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>parameter<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n      <th>method<\/th>\n      <th>alternative<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,7,8,9,10,11,12]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":".sim_id","targets":1},{"name":"n","targets":2},{"name":"mean_diff","targets":3},{"name":"sd","targets":4},{"name":"rep","targets":5},{"name":"Source","targets":6},{"name":"estimate","targets":7},{"name":"statistic","targets":8},{"name":"p.value","targets":9},{"name":"parameter","targets":10},{"name":"conf.low","targets":11},{"name":"conf.high","targets":12},{"name":"method","targets":13},{"name":"alternative","targets":14}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="a-complete-solution-with-varying-parameters" class="level3">
<h3 class="anchored" data-anchor-id="a-complete-solution-with-varying-parameters">A complete solution with varying parameters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sim_vary <span class="ot">&lt;-</span> <span class="fu">specify</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre  =</span> <span class="sc">~</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sd),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> <span class="sc">~</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(n, mean_diff, sd)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">100</span>, <span class="at">.progress =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">t =</span> <span class="sc">~</span><span class="fu">t.test</span>(post, pre, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_fits</span>()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>sim_vary <span class="sc">|&gt;</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(n, mean_diff, sd) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Power =</span> <span class="fu">mean</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, Power)) <span class="sc">+</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(sd), <span class="at">cols =</span> <span class="fu">vars</span>(mean_diff)) <span class="sc">+</span> </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'n', 'mean_diff'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="simulator_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="philosophy" class="level3">
<h3 class="anchored" data-anchor-id="philosophy">Philosophy</h3>
<p>The <a href="https://statisfactions.github.io/simpr/"><strong>simpr</strong></a> workflow, inspired by the <a href="https://infer.tidymodels.org"><strong>infer</strong></a> package, distills a simulation study into five primary steps:</p>
<ul>
<li><code>specify()</code> your data-generating process;</li>
<li><code>define()</code> parameters that you want to systematically vary across your simulation design (e.g.&nbsp;n, effect size);</li>
<li><code>generate()</code> the simulation data;</li>
<li><code>fit()</code> models to your data (e.g.&nbsp;<code>lm()</code>);</li>
<li><code>tidy_fits()</code> for consolidating results using <code>broom::tidy()</code>, such as computing power or Type I Error rates.</li>
</ul>
</section>
<section id="reproducible-workflows" class="level3">
<h3 class="anchored" data-anchor-id="reproducible-workflows">Reproducible workflows</h3>
<ul>
<li>Same seed, same results;</li>
<li>Can regenerate just a <em>specific subset</em> to see what happened in that particular dataset or fit;</li>
<li>Useful in debugging and diagnosing unexpected results, etc.</li>
</ul>
<section id="filtering-full-simulation" class="level4">
<h4 class="anchored" data-anchor-id="filtering-full-simulation">Filtering full simulation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">500</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.sim_id <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>full tibble
--------------------------
# A tibble: 1 × 3
  .sim_id   rep sim             
    &lt;int&gt; &lt;int&gt; &lt;list&gt;          
1       3     3 &lt;tibble [6 × 1]&gt;

sim[[1]]
--------------------------
# A tibble: 6 × 1
      a
  &lt;dbl&gt;
1 0.371
2 0.959
3 0.633
4 0.177
5 0.803
6 0.133</code></pre>
</div>
</div>
</section>
<section id="simulate-subset-only" class="level4">
<h4 class="anchored" data-anchor-id="simulate-subset-only">Simulate subset only</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">500</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">3</span>, .sim_id <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>full tibble
--------------------------
# A tibble: 1 × 3
  .sim_id   rep sim             
    &lt;int&gt; &lt;int&gt; &lt;list&gt;          
1       3     3 &lt;tibble [6 × 1]&gt;

sim[[1]]
--------------------------
# A tibble: 6 × 1
      a
  &lt;dbl&gt;
1 0.371
2 0.959
3 0.633
4 0.177
5 0.803
6 0.133</code></pre>
</div>
</div>
</section>
<section id="benchmarking" class="level4">
<h4 class="anchored" data-anchor-id="benchmarking">Benchmarking</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">500</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate</span>(<span class="dv">1000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(.sim_id <span class="sc">==</span> <span class="dv">1000</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> <span class="fu">specify</span>(<span class="at">a =</span> <span class="sc">~</span> <span class="fu">runif</span>(<span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate</span>(<span class="dv">1000</span>, .sim_id <span class="sc">==</span> <span class="dv">1000</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">check =</span> <span class="cn">FALSE</span>, <span class="at">min_iterations =</span> <span class="dv">10</span>L, <span class="at">relative =</span> <span class="cn">TRUE</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Some expressions had a GC in every iteration; so filtering is
disabled.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  expression   min median `itr/sec` mem_alloc `gc/sec`
  &lt;bch:expr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 all         56.8   59.3       1        1        1   
2 subset       1      1        55.9      1.28     1.19</code></pre>
</div>
</div>
</section>
</section>
<section id="other-features" class="level3">
<h3 class="anchored" data-anchor-id="other-features">Other features</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data munging
</div>
</div>
<div class="callout-body-container callout-body">
<p>Add <code>per_sim() |&gt;</code> after <code>generate()</code> in your simulation pipeline and then any tidyverse function that will apply to every simulation dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre  =</span> <span class="sc">~</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sd), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> <span class="sc">~</span> pre <span class="sc">+</span> <span class="fu">rnorm</span>(n, mean_diff, sd)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>), </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="dv">1000</span>, <span class="at">.progress =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Apply tidyverse functions to every simulation dataset</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">per_sim</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mutate to add a range restriction</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    pre <span class="sc">&gt;</span>  <span class="dv">100</span> <span class="sc">~</span> <span class="dv">100</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    pre <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">100</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">100</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    .default   <span class="sc">~</span> pre</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">|&gt;</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">t =</span> <span class="sc">~</span> <span class="fu">t.test</span>(post, pre, <span class="at">paired =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_fits</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Error handling
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Can change error handling to keep going with simulation, stop simulation, or to skip warnings;</li>
<li>Debug and recovery options to enter into simulation during error.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Built-in parallelization
</div>
</div>
<div class="callout-body-container callout-body">
<p>Just add</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">6</span>) <span class="co"># or however many cores are reasonable to use</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and your simulation pipeline (actually the <code>generate()</code> function) will run in parallel.</p>
</div>
</div>
</section>
<section id="pros-cons" class="level3">
<h3 class="anchored" data-anchor-id="pros-cons">Pros &amp; Cons</h3>
<div class="columns">
<div class="column">
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pros
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>tidyverse friendly;</li>
<li>beginner friendly;</li>
<li>Reproducibility, error handling built in;</li>
<li>General-purpose, customizable and can handle arbitrary R code.</li>
</ul>
</div>
</div>
</div><div class="column">
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cons
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Likely not as fast/optimized as some alternatives;</li>
<li>Not as customizable/powerful as <strong>DeclareDesign</strong>;</li>
<li>Not specifically set up for any particular application (no MC errors, plots, reports, specific models…).</li>
</ul>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>